<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Admin Paneli - Optik Okuyucu</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&amp;display=swap"
        rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <meta name="color-scheme" content="light">
    <script src="theme-manager.js"></script>
    <script type="module" src="firebase-config.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: "#7C3AED",
                        background: "#FAFAFA",
                        surface: "#FFFFFF",
                        "text-main": "#1e293b",
                        "text-muted": "#64748b",
                    },
                    fontFamily: {
                        sans: ['Plus Jakarta Sans', 'sans-serif'],
                    },
                    boxShadow: {
                        'soft': '0 4px 20px -2px rgba(0, 0, 0, 0.05)',
                        'card': '0 10px 15px -3px rgba(0, 0, 0, 0.04)',
                        'glow': '0 4px 14px rgba(124, 58, 237, 0.15)',
                    }
                },
            },
        };
    </script>
    <style>
        body {
            background-color: #f8fafc;
            min-height: 100vh;
            min-height: max(884px, 100dvh);
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>

<body class="font-sans antialiased text-text-main">
    <div class="max-w-md mx-auto min-h-screen relative flex flex-col bg-[#fdfdff] shadow-xl overflow-hidden pb-24">
        <!-- Header -->
        <header
            class="px-6 pt-10 pb-4 flex items-center justify-between sticky top-0 bg-[#fdfdff]/80 backdrop-blur-md z-30">
            <button onclick="window.location.href='settings.html'"
                class="w-10 h-10 rounded-full bg-white shadow-soft flex items-center justify-center text-gray-500 hover:text-primary transition-colors border border-gray-50">
                <span class="material-symbols-outlined text-2xl">chevron_left</span>
            </button>
            <h1 class="font-extrabold text-lg text-gray-900">Kurum Yönetimi</h1>
            <div class="w-10 h-10 flex items-center justify-center">
                <span class="material-symbols-outlined filled text-primary opacity-50 text-2xl">shield_person</span>
            </div>
        </header>

        <main class="flex-1 px-6 space-y-7 overflow-y-auto no-scrollbar pt-2">

            <div class="bg-gradient-to-br from-primary to-indigo-600 p-6 rounded-3xl shadow-glow text-white">
                <h2 class="text-xl font-bold mb-2">Yeni Kurum Ekle</h2>
                <p class="text-sm text-indigo-100 font-medium mb-6">Sisteme yeni bir kullanıcı/kurum girişi tanımlayın.
                </p>

                <form id="addInstitutionForm" class="space-y-4">
                    <div class="space-y-1.5 hidden" id="errorContainer">
                        <div
                            class="p-3 bg-red-500/10 border border-red-500/20 text-white text-sm font-bold rounded-xl text-center">
                            Hata oluştu.
                        </div>
                    </div>
                    <div class="space-y-1.5 hidden" id="successContainer">
                        <div
                            class="p-3 bg-green-500/10 border border-green-500/20 text-white text-sm font-bold rounded-xl text-center">
                            Kurum başarıyla eklendi!
                        </div>
                    </div>

                    <div class="space-y-1.5">
                        <label
                            class="block text-[11px] font-bold text-indigo-100 uppercase tracking-widest ml-1">Kullanıcı
                            Adı</label>
                        <input type="text" id="newUsername" required
                            class="w-full bg-white/10 border border-white/20 rounded-xl px-4 py-3 text-white placeholder-indigo-200 focus:ring-2 focus:ring-white/50 focus:border-transparent transition-all"
                            placeholder="Örn: testkurum">
                    </div>

                    <div class="space-y-1.5">
                        <label
                            class="block text-[11px] font-bold text-indigo-100 uppercase tracking-widest ml-1">Şifre</label>
                        <input type="password" id="newPassword" required
                            class="w-full bg-white/10 border border-white/20 rounded-xl px-4 py-3 text-white placeholder-indigo-200 focus:ring-2 focus:ring-white/50 focus:border-transparent transition-all"
                            placeholder="••••••••">
                    </div>

                    <div class="space-y-1.5">
                        <label class="block text-[11px] font-bold text-indigo-100 uppercase tracking-widest ml-1">Kurum
                            Adı (Opsiyonel)</label>
                        <input type="text" id="newName"
                            class="w-full bg-white/10 border border-white/20 rounded-xl px-4 py-3 text-white placeholder-indigo-200 focus:ring-2 focus:ring-white/50 focus:border-transparent transition-all"
                            placeholder="Örn: Optik Okuyucu Dershanesi">
                    </div>

                    <button type="submit" id="submitBtn"
                        class="w-full bg-white text-primary font-bold py-3.5 rounded-xl shadow-soft hover:bg-indigo-50 transition-colors mt-2 flex items-center justify-center gap-2">
                        <span class="material-symbols-outlined text-[20px]">add_circle</span>
                        Kullanıcı Tanımla
                    </button>
                </form>
            </div>

            <!-- Existing Users List (Optional, can be added later) -->
            <div class="space-y-3">
                <h3 class="text-[10px] font-black text-gray-400 uppercase tracking-[0.2em] ml-1">Kayıtlı Kurumlar</h3>
                <div
                    class="bg-white rounded-3xl border border-gray-100 shadow-card p-6 text-center text-gray-400 text-sm font-medium">
                    (Bu liste henüz geliştirilme aşamasındadır.)
                </div>
            </div>

        </main>

        <script type="module">
            import { getCurrentUser, addInstitutionUser } from './firebase-config.js';

            // Check Admin Auth
            const user = getCurrentUser();
            if (!user || user.role !== 'admin') {
                window.location.href = 'dashboard.html';
            }

            document.getElementById('addInstitutionForm').addEventListener('submit', async (e) => {
                e.preventDefault();

                const username = document.getElementById('newUsername').value.trim();
                const password = document.getElementById('newPassword').value;
                const name = document.getElementById('newName').value.trim();

                const errorContainer = document.getElementById('errorContainer');
                const errorMessage = errorContainer.querySelector('div');
                const successContainer = document.getElementById('successContainer');
                const submitBtn = document.getElementById('submitBtn');

                errorContainer.classList.add('hidden');
                successContainer.classList.add('hidden');

                if (!username || !password) return;

                const originalBtnText = submitBtn.innerHTML;
                submitBtn.disabled = true;
                submitBtn.innerHTML = `<span class="material-symbols-outlined animate-spin">sync</span> Ekleniyor...`;

                try {
                    const result = await addInstitutionUser(username, password, name);

                    if (result.success) {
                        successContainer.classList.remove('hidden');
                        document.getElementById('addInstitutionForm').reset();
                    } else {
                        errorMessage.textContent = result.message || "Bir hata oluştu.";
                        errorContainer.classList.remove('hidden');
                    }
                } catch (error) {
                    console.error("Hata:", error);
                    errorMessage.textContent = "Bağlantı hatası oluştu.";
                    errorContainer.classList.remove('hidden');
                } finally {
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = originalBtnText;
                }
            });

        </script>
    </div>
</body>

</html>